<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Community Classifieds â€” Nakamura Grant Solutions</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Montserrat:wght@600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b0f1a;--bg-2:#0f1628;--text:#e7ecf6;--muted:#b9c2d8;
      --line:rgba(255,255,255,0.08);--shadow:0 10px 30px rgba(0,0,0,0.35);
      --radius:16px;--maxw:1120px;
    }
    body{margin:0;font-family:Inter,system-ui;line-height:1.6;color:var(--text);
      background:linear-gradient(180deg,var(--bg),var(--bg-2));}
    .container{max-width:var(--maxw);margin:0 auto;padding:0 24px;}
    section{padding:72px 0;}
    .section-title{font-family:Montserrat,Inter,sans-serif;font-weight:700;font-size:28px;margin:0 0 10px;}
    .section-sub{color:var(--muted);margin:0 0 28px;}
    form{background:rgba(255,255,255,0.03);border:1px solid var(--line);border-radius:var(--radius);padding:24px;box-shadow:var(--shadow);}
    label{display:block;margin-bottom:6px;font-weight:600;}
    input,textarea{width:100%;padding:10px;border-radius:var(--radius);border:1px solid var(--line);background:rgba(255,255,255,0.05);color:var(--text);margin-bottom:16px;}
    textarea{min-height:100px;}
    button{background:#5ee1d6;color:#0b0f1a;font-weight:700;border:none;border-radius:999px;padding:10px 18px;cursor:pointer;}
    .classifieds{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:24px;margin-top:40px;}
    .listing{background:rgba(255,255,255,0.04);border:1px solid var(--line);border-radius:var(--radius);padding:20px;box-shadow:var(--shadow);}
    .listing h3{margin:0 0 8px;font-weight:700;}
    .listing p{margin:0 0 10px;color:var(--muted);}
    .meta{color:#a8b2ca;font-size:14px;}
  </style>
</head>
<body>
  <section id="classifieds">
    <div class="container">
      <div class="section-title">Community Classifieds</div>
      <p class="section-sub">Browse and add your listing. Entries appear instantly for everyone.</p>

      <!-- Submission form -->
      <form id="classifiedForm">
        <label for="title">Title</label>
        <input id="title" name="title" type="text" required>

        <label for="description">Description</label>
        <textarea id="description" name="description" required></textarea>

        <label for="contact">Contact</label>
        <input id="contact" name="contact" type="text" required>

        <label for="category">Category (optional)</label>
        <input id="category" name="category" type="text">

        <button type="submit">Submit Classified</button>
        <p id="formStatus" class="meta"></p>
      </form>

      <!-- Listings -->
      <div id="classifiedList" class="classifieds"></div>
      <div id="pagination" class="meta"></div>
    </div>
  </section>

  <script>
    const API_BASE = 'http://localhost:4000/api'; // change to your deployed API

    async function fetchClassifieds(page=1){
      const res = await fetch(`${API_BASE}/classifieds?page=${page}&limit=12`);
      const json = await res.json();
      renderList(json.data);
      renderPagination(json.page,json.limit,json.total);
    }
    function renderList(items){
      const el=document.getElementById('classifiedList');
      el.innerHTML=items.map(item=>`
        <div class="listing">
          <h3>${escapeHtml(item.title)}</h3>
          <p>${escapeHtml(item.description)}</p>
          <p><strong>Contact:</strong> ${escapeHtml(item.contact)}</p>
          ${item.category?`<p class="meta"><strong>Category:</strong> ${escapeHtml(item.category)}</p>`:''}
          <p class="meta">Posted: ${new Date(item.created_at).toLocaleString()}</p>
        </div>`).join('');
    }
    function renderPagination(page,limit,total){
      const el=document.getElementById('pagination');
      const pages=Math.max(Math.ceil(total/limit),1);
      el.innerHTML=`<span>Page ${page} of ${pages}</span>
        ${page>1?`<a href="#" data-p="${page-1}">Prev</a>`:''}
        ${page<pages?`<a href="#" data-p="${page+1}" style="margin-left:8px;">Next</a>`:''}`;
      el.querySelectorAll('a').forEach(a=>a.addEventListener('click',e=>{
        e.preventDefault();fetchClassifieds(parseInt(e.target.dataset.p,10));
      }));
    }
    function escapeHtml(str){return String(str).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;').replaceAll("'","&#039;");}
    document.getElementById('classifiedForm').addEventListener('submit',async e=>{
      e.preventDefault();
      const status=document.getElementById('formStatus');
      const payload={
        title:document.getElementById('title').value.trim(),
        description:document.getElementById('description').value.trim(),
        contact:document.getElementById('contact').value.trim(),
        category:document.getElementById('category').value.trim()
      };
      try{
        const res=await fetch(`${API_BASE}/classifieds`,{
          method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)
        });
        if(!res.ok){status.textContent='Error submitting';return;}
        status.textContent='Submitted! Your listing is live.';
        e.target.reset();fetchClassifieds(1);
      }catch(err){status.textContent='Network error';}
    });
    fetchClassifieds();
  </script>
</body>
</html>
